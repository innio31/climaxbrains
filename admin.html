<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Results Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #6a0dad;
            --secondary-color: #722f37;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        .badge-primary {
            background-color: var(--primary-color);
        }
        .badge-secondary {
            background-color: var(--secondary-color);
        }
        .score-high { color: #28a745; font-weight: bold; }
        .score-medium { color: #ffc107; font-weight: bold; }
        .score-low { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header text-center">
            <h1><i class="fas fa-graduation-cap"></i> Exam Results Admin</h1>
            <p class="mb-0">View and manage examination results</p>
        </div>

        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-list"></i> All Results</h5>
                <div>
                    <span class="badge bg-primary me-2">Total: <span id="totalResults">0</span></span>
                    <span class="badge bg-success">Average: <span id="averageScore">0</span>%</span>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Subject</th>
                                <th>Exam Type</th>
                                <th>Term/Session</th>
                                <th>Objective</th>
                                <th>Theory</th>
                                <th>Submitted</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTable">
                            <!-- Results will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Your Firebase configuration
        const firebaseConfig = {
  apiKey: "AIzaSyDuKgSUZejLLveOe8oXlHo64OnCDFvwPc4",
  authDomain: "climax-brains-academy-cbt.firebaseapp.com",
  projectId: "climax-brains-academy-cbt",
  storageBucket: "climax-brains-academy-cbt.firebasestorage.app",
  messagingSenderId: "1024257040553",
  appId: "1:1024257040553:web:3cc25d238fa378358f09b8",
  measurementId: "G-LVDHYESXJG"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // DOM elements
        const resultsTable = document.getElementById('resultsTable');
        const totalResults = document.getElementById('totalResults');
        const averageScore = document.getElementById('averageScore');

        // Load results from Firebase
        function loadResults() {
            database.ref('examResults').orderByChild('timestamp').on('value', (snapshot) => {
                const results = [];
                let totalScore = 0;
                let count = 0;

                snapshot.forEach(childSnapshot => {
                    const result = childSnapshot.val();
                    result.id = childSnapshot.key;
                    results.unshift(result); // Add to beginning to show newest first
                    
                    if (result.objectiveScore) {
                        totalScore += result.objectiveScore;
                        count++;
                    }
                });

                displayResults(results);
                
                // Update summary
                totalResults.textContent = results.length;
                averageScore.textContent = count > 0 ? Math.round(totalScore / count) : 0;
            });
        }

        // Display results in the table
        function displayResults(results) {
            resultsTable.innerHTML = '';

            if (results.length === 0) {
                resultsTable.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-4">No results found in database</td>
                    </tr>
                `;
                return;
            }

            results.forEach(result => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${result.name || 'N/A'}</td>
                    <td>${result.class ? result.class.toUpperCase() : 'N/A'}</td>
                    <td>${result.subject ? capitalizeFirstLetter(result.subject) : 'N/A'}</td>
                    <td>${getExamTypeBadge(result.examType)}</td>
                    <td>${result.term ? `${capitalizeFirstLetter(result.term)} Term` : ''} ${result.session || ''}</td>
                    <td class="${getScoreClass(result.objectiveScore)}">
                        ${result.objectiveScore || result.objectiveScore === 0 ? result.objectiveScore + '%' : 'N/A'}
                    </td>
                    <td class="${getScoreClass(result.theoryScore)}">
                        ${result.theoryScore || result.theoryScore === 0 ? result.theoryScore + '%' : 'Pending'}
                    </td>
                    <td>${formatDate(result.submittedAt || result.timeStamp)}</td>
                `;
                
                resultsTable.appendChild(row);
            });
        }

        // Helper functions
        function getExamTypeBadge(type) {
            if (!type) return 'N/A';
            
            const types = {
                'ca': ['CA', 'primary'],
                'midterm': ['Midterm', 'warning'],
                'exam': ['Exam', 'danger']
            };
            
            const [label, style] = types[type] || ['Other', 'secondary'];
            return `<span class="badge bg-${style}">${label}</span>`;
        }

        function getScoreClass(score) {
            if (score === undefined || score === null) return '';
            if (score >= 70) return 'score-high';
            if (score >= 50) return 'score-medium';
            return 'score-low';
        }

        function capitalizeFirstLetter(string) {
            if (!string) return '';
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'N/A';
            
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Initialize the page
        loadResults();
    </script>
</body>
</html>
